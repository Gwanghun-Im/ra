FROM python:3.12-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements
COPY pyproject.toml /app/

# Install Python dependencies
RUN pip install --no-cache-dir uv && \
    uv pip install --system \
    langgraph>=0.6.2 \
    fastmcp>=2.11.0 \
    a2a-sdk>=0.3.0 \
    langchain>=0.3.0 \
    langchain-openai>=0.2.0 \
    fastapi>=0.115.0 \
    uvicorn>=0.30.0 \
    redis>=5.0.0 \
    httpx \
    python-dotenv \
    pyyaml

# Copy application files
COPY src/agents/ /app/agents/
COPY src/a2a/ /app/a2a/
COPY src/mcp_custom/ /app/mcp_custom/
COPY config/ /app/config/

# Set Python path so modules can be imported
ENV PYTHONPATH=/app

# Expose port
EXPOSE 8099

# Run Supervisor A2A server
CMD ["python", "-m", "uvicorn", "a2a.supervisor_server:app", "--host", "0.0.0.0", "--port", "8099"]
